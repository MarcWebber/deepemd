摘要：小样本图像学习。使用EMD作为指标来评估不同`密集图像表示`之间的结构距离，以此确定图像相关性。

EMD模型起到优化匹配，减少匹配开销的作用。使用`交叉索引`机制找寻EMD方程中的权重，以减少由数据混乱和类内不一致产生的负面影响。

学习一个结构化的`全连接层`以直接分类密集型图像表示。

根据`隐函数定理`，EMD模型可以作为端对端学习神经网络的一个层。deepemd方法在表现上超过了当前最广泛应用的五个方法：

1. minilmageNet
2. tieredImageNet
3. FC100
4. CUB
5. CIFAR-FS

实验同样验证了我们的誓言在`图像检索`领域的高效性



## Introduction

深度学习网络在视觉领域取得了很大的成就，且需要大量的标注数据。 深度学习网络饱受`低效样本`的折磨。这种学习方式和人类学习方式大相径庭，小样本学习则致力于解决这个问题，以往这个问题你都被作为`广泛元学习`的一个子领域。

> 元学习是机器学习的一个子领域，着重于开发算法和技术，使模型能够更高效地从数据中学习如何学习。在不同领域之间进行知识的适应和迁移，同时学习多个相关任务，或将额外的信息源或先前的知识纳入元学习过程中。它旨在开发更灵活、多用途的学习算法，能够有效处理各种学习场景，并更好地适应新的任务或环境。

元学习算法的一个目前研究最深入的实验平台是`小样本图像分类`。其致力于在仅有少量标注样本的前提下执行分类任务。

为了解决这个问题，之前的一系列学习方法采用了`基于指标的方法`。

> 这些方法在合适的特征空间中表示图像数据，并采用距离公式来推测图像标签。这些方法往往和标准图像分类网络遵循着相似的规则，采用卷积层来学习图像特征表示，并将全连接层变为一个距离函数。距离函数会直接计算test images以及training images embeddings的距离来进行分类而忽视了在小样本情况下分类的困难性。这些方法往往采用分布取样以期最终的学习成果有不错的泛化性。

然而，我们发现了在`背景杂乱`以及`类内差异大`的情况下，相同类别的图像embeddings可能会在指标上相去甚远。在有充分数据的情况下，这种问题可以用全监督的方式进行改善。

然而，这种问题会不可避免地在小样本情况下放大并极大的影响分类准确性。除此之外，一个混杂的全局表示也可能很难捕捉到图片结构，并很可能丢失有用的`局部特征`。

> 这些特征通常用于描述图像中的局部结构、纹理、角点等信息，具有一定的不变性和重复性，可用于图像匹配、目标识别、图像检索等任务。tr

局部特征可以提供类间很有辨识度且具有传递性的一些信息，在小样本学习场景下非常有用。因此，==一个理想的基于指标的算法应当能够区分出局部有辨识度的特征，且减少无关项的干扰==

我们很自然可以想到通过比较==构建块==的方式来比较相似度。但我很很可能在训练中缺少监督，且不能保证每一个`构建块`都能其他结构中找到相似物。为了结束上述问题，我们提出了一个小样本分类方法：`使用两个结构间的最优匹配成本来表示两者之间的相似度`

给定两个图像的局部特征表示集合，我们使用EMD来计算它们的结构相似度。

> Earth Mover's Distance（EMD，也称为Wasserstein距离）是一种用于度量两个概率分布之间差异的距离度量指标。最先被应用于图像检索（Image Retrieval）
>
> EMD的概念源自于运输问题（Transportation Problem）和线性规划。它通过考虑将一个分布转移到另一个分布所需的最小总成本来衡量两个分布之间的差异。
>
> 在概率分布的情况下，EMD可以看作是将一种分布中的"土堆"移动到另一种分布中的"土堆"所需的最小总成本。这种成本可以被解释为在一个分布中的单位质量与另一个分布中的单位质量之间的距离。因此，EMD衡量了通过最佳方式将一种分布转换为另一种分布所需的平均成本。
>
> EMD的计算方法基于线性规划技术，它考虑了两个分布之间的质量差异以及从一个位置到另一个位置的运输成本。这种距离度量可以应用于不同领域，例如图像处理、文本分析、模式识别等。
>
> EMD具有一些优良的性质，例如具备度量空间的性质，它能够衡量分布之间的差异程度，并且对分布的噪声和局部变化相对较鲁棒。
>
> 需要注意的是，EMD的计算可能是计算密集型的，特别是在高维空间和大规模数据集上。因此，在实际应用中，可能需要使用近似算法或结合其他技术来计算EMD。
>
> 总结起来，Earth Mover's Distance是一种用于度量两个概率分布之间差异的距离度量，它考虑了分布转移的成本和距离，适用于多个领域的数据分析和模式识别问题。

这篇文章的工作大概可以这么理解流程（取局部特征，进行匹配）。为了使其能够嵌入其他的端对端学习模型，我们使用了`隐函数定理`来构建优化变量相对于问题参数的雅可比矩阵。

> 这么做可以将问题参数视为独立变量，优化问题视为以来变量，描述优化变量相对于问题参数的变化率或者敏感度。

![image-20231011185355355](C:\Users\29989\AppData\Roaming\Typora\typora-user-images\image-20231011185355355.png)

我们探索了多种提取局部特征表示的方法，包括全卷积神经网络，==图像网格（将多个图像按照网格形式排列）====这是什么东东？==以及图像区域采集。

![image-20231011192531272](C:\Users\29989\AppData\Roaming\Typora\typora-user-images\image-20231011192531272.png)

（==这是什么东西，没看懂==）

EMD方程中一个很重要且与问题相关联的参数是每个`参数的权重`。大权重元素产生更多的`匹配流（match flow）`，且对于总体影响更多。理想情况下，这个算法应当具有灵活调整的能力以分配给不相关区域更下的权重值。为了达成这个目标，我们提出了一个`交叉引用(cross reference)`的机制，来决定一个元素的重要程度

==在`cross-reference`机制中，我们通过将一个节点和其他结构的全局统计数据进行比较来决定一个节点的权重==。

直观来看，一个和其他图片有更多相关性的区域更有可能被赋予更高权重，同时，高度差异化的背景在计算matching cost的时候影响就会尽可能减小。

==其实就是用另一种方法选择出图像主体而排除掉背景的影响==

在有多个支持图像的k-shot数据集中，我们学习一个`结构化的全连接层(FC layer)`作为分类器，这样可以最大化的利用可能变多的训练图像。结构化的全连接层包括一个每个类都具有的一组`可学习向量`(learnable vectors)。结构化的全连接层是标准全连接层的拓展，它取缔了向量间的`点乘`操作，==这样一来他就可以被用来直接分类了？？？？？==它也可以用来学习由每个类的假图片产生的局部特征(`prototype embeddings`)

为了验证我们的算法，我们在大量数据集上进行了验证，且都被证明为有效。我们的贡献大致如下：

1. 将小样本图片分类规范化为一个最优匹配问题，并采用EMD模型
2. 采用cross-reference机制
3. 学习一个结构化全连接层
4. 在五个小样本学习数据集上进行了测试。

## 预知识

`N-way K-shot`任务表示有N个待分类，每个类中有K个样本。为了能够获取不同任务间的泛化性，模型通常使用情节范式`episodic paradigm`

> 情节范式（episodic paradigm）是一种训练和评估机器学习模型的方法，特别适用于具有多个任务的情况。在情节范式中，任务被视为一系列情节（episodes），每个情节都包含输入数据和相应的标签或目标。在每个情节中，模型接收输入数据，并根据标签或目标进行预测。然后，模型的预测结果与真实标签进行比较，并计算损失或评估指标。
>
> 在训练过程中，模型会从一批情节中随机选择一部分作为训练样本，然后使用这些情节进行参数更新。这种随机选择的过程有助于模型学习不同任务之间的共享知识和通用特征，从而提高其在新任务上的泛化能力。

在每一个样本中，训练集被叫做`support set`，测试集被叫做`query set`，训练时`query set`的label作为监督。推断时，反复进行抽样评估

![image-20231031183122855](C:\Users\29989\AppData\Roaming\Typora\typora-user-images\image-20231031183122855.png)

（以上是1shot 图像分类，使用了3种方式进行探索：

1. fully convolutional networks, 
2. cropping image patches based on grids; and
3. random sampling of image patches. The details of the three methods are provided in Section 4.2）

## 方法

### EMD方法

用于度量两个分布或者对象的距离，基于每个元素距离。具有`线性规划中的交通问题`形式。

> 交通问题的目标是在给定的交通网络中找到最优的交通流量分配方案，以最小化总体的交通成本或最大化交通效益。

EG：

$$S=\{s_i|i=1,2,...m\}$$

$$D=\{d_j|j=1,2,...k\}$$

